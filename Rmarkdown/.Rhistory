setwd("E:/Montreal-Asphalt-Detectives/Rmarkdown")
accidentsDF <- read.csv('../data/created/timeseries/ts_accidents_by_date.csv',
header = TRUE)
library(tidyverse)
library(scales)
library(knitr)
#library(epiDisplay)
library(forecast)
library(lubridate)
library(grid)
library(magrittr)
library(tibbletime)
regressors <- accidentsDF %>%
select(-starts_with('cluster'),-Date, -NB_Accidents,
-starts_with('NB'), -starts_with('as.factor.Accident')) %>%
as.matrix()
accidentsDF %<>%
select(Date, NB_Accidents) %>%
mutate(Date = as.Date(Date))
#making data to weekly
weeks = as.Date(cut(accidentsDF$Date, '7d',))
accidentsDF %<>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise(NB_Accidents = sum(NB_Accidents))
#d = as_tbl_time(accidentsDF, index=Date)
#d %<>% as_period('week')
dts = ts(accidentsDF$NB_Accidents, start=c(2012,1),
end = c(2020,53), frequency = 53)
accidentsDF %<>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise(NB_Accidents = sum(NB_Accidents))
#d = as_tbl_time(accidentsDF, index=Date)
#d %<>% as_period('week')
dts = ts(accidentsDF$NB_Accidents, start=c(2012,1),
end = c(2020,53), frequency = 53)
fit <- auto.arima(dts, stepwise = T, parallel = TRUE,num.cores = 4);fit
checkresiduals(fit)
Pacf(residuals(fit))
accidentsDF %>%
filter(day(Date) == 29 & month(Date)==2)
accidentsDF %>%
filter(day(Date) == 28 & month(Date)==2)
accidentsDF %>% head
accidentsDF[1,1]
day(accidentsDF[1,1])
day(as.date(accidentsDF[1,1]))
day(as.Date(accidentsDF[1,1]))
day(as.Date(accidentsDF[[1,1]]))
day(as.Date(accidentsDF[[15,1]]))
accidentsDF <- read.csv('../data/created/timeseries/ts_accidents_by_date.csv',
header = TRUE)
regressors <- accidentsDF %>%
select(-starts_with('cluster'),-Date, -NB_Accidents,
-starts_with('NB'), -starts_with('as.factor.Accident')) %>%
as.matrix()
accidentsDF %<>%
select(Date, NB_Accidents) %>%
mutate(Date = as.Date(Date))
accidentsDF %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise(NB_Accidents = sum(NB_Accidents))  ->
accidentsDF.weekly
accidentsDF %>%
filter(day(Date) == 27 & month(Date)==2)
accidentsDF %>%
filter(day(Date) == 29 & month(Date)==2)
accidentsDF %>%
filter(! (day(Date) == 29 & month(Date)==2))
accidentsDF %>%
filter(! (day(Date) == 29 & month(Date)==2)) %>% nrow
accidentsDF %>%
filter(! (day(Date) == 29 & month(Date)==2)) -> accidentsDF.daily
3285 / 365
dts.d = ts(accidentsDF.daily$NB_Accidents, start=c(2012,1),
end = c(2020, 365), frequency = 365)
fit <- auto.arima(dts.d, stepwise = T, parallel = TRUE,num.cores = 4);fit
checkresiduals(fit)
fit <- auto.arima(dts.d, stepwise = F, parallel = TRUE,num.cores = 4);fit
fit <- auto.arima(dts.d, stepwise = F, parallel = TRUE,num.cores = 8);fit
fitt = arima(dts.d, order = c(2,1,2),seasonal = list(period=365))
fitt = arima(dts.d, order = c(2,1,2),
seasonal = list(order = c(1,0,1),period=365))
fit <- auto.arima(dts.d, stepwise = F,seasonal = F,
xreg = fourier(dts.d, k=4),
parallel = TRUE,num.cores = 8);fit
fit <- auto.arima(dts.d, stepwise = F,seasonal = F,
xreg = fourier(dts.d, K=4),
parallel = TRUE,num.cores = 8);fit
checkresiduals(fit)
fit <- auto.arima(dts.d, stepwise = F,seasonal = F,
xreg = fourier(dts.d, K=1),
parallel = TRUE);fit;checkresiduals(fit)
fit <- auto.arima(dts.d, stepwise = F,seasonal = F,
xreg = fourier(dts.d, K=8),
parallel = TRUE);fit;checkresiduals(fit)
library(forecast)
fit.tb = tbats(dts.d)
summary(fit.tb)
fit.tb
checkresiduals(fit.tb)
365/7
52*7
dts = ts(accidentsDF.weekly$NB_Accidents, start=c(2012,1),
end = c(2020,53), frequency = 53)
dts.w = ts(accidentsDF.weekly$NB_Accidents, start=c(2012,1),
end = c(2020,53), frequency = 53)
fit.w <- auto.arima(dts.w, stepwise = F,seasonal = T,
parallel = TRUE);fit;checkresiduals(fit)
fit.w <- auto.arima(dts.w, stepwise = T,seasonal = T, trace = T,
parallel = TRUE);fit;checkresiduals(fit)
fit.w <- auto.arima(dts.w, stepwise = T,trace = T,
parallel = TRUE);fit.w;checkresiduals(fit.w)
plot(fit.w)
plot(forecast(fit.w,h=20))
Pacf(residuals(fit.w))
fit.tb = tbats(dts.w); summary(fit.tb)
fit.tb
fit.tb$seasonal.periods
fit.w <- auto.arima(dts.w, stepwise = T,seasonal = F,
xreg = fourier(dts.w, k=4),
parallel = TRUE);fit.w;checkresiduals(fit.w)
fit.w <- auto.arima(dts.w, stepwise = T,seasonal = F,
xreg = fourier(dts.w, K=4),
parallel = TRUE);fit.w;checkresiduals(fit.w)
fit.w <- auto.arima(dts.w, stepwise = T,seasonal = F,
xreg = fourier(dts.w, K=2),
parallel = TRUE);fit.w;checkresiduals(fit.w)
fit.w <- auto.arima(dts.w, stepwise = T,trace = F,xreg=regressors,
parallel = TRUE);fit.w;checkresiduals(fit.w)
# Transfer data into weekly
accidentsDF %>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident')) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>% View
accidentsDF <- read.csv('../data/created/timeseries/ts_accidents_by_date.csv',
header = TRUE)
# Transfer data into weekly
accidentsDF %>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident')) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>% View
# Transfer data into weekly
accidentsDF %<>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident')) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>% View
# Transfer data into weekly
accidentsDF %<>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident')) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>%
select(-y)
accidentsDF <- read.csv('../data/created/timeseries/ts_accidents_by_date.csv',
header = TRUE)
# Transfer data into weekly
accidentsDF %<>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident')) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>%
select(-y)
accidentsDF <- read.csv('../data/created/timeseries/ts_accidents_by_date.csv',
header = TRUE)
# Transfer data into weekly
accidentsDF %<>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident'),
NB_Accidents) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>%
select(-y)
accidentsDF %>%
select(-Date, -NB_Accidents) %>%
as.matrix() -> predictors
accidentsDF <- read.csv('../data/created/timeseries/ts_accidents_by_date.csv',
header = TRUE)
# Transfer data into weekly
accidentsDF %<>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident'),
NB_Accidents) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>%
select(-y) -> accidentsDF.weekly
accidentsDF.weekly %<>%
select(Date, NB_Accidents)
accidentsDF.weekly %>%
select(-Date, -NB_Accidents) %>%
as.matrix() -> predictors.weekly
# Transfer data into weekly
accidentsDF %<>%
select(-starts_with('cluster'),
-starts_with('NB'), -starts_with('as.factor.Accident'),
NB_Accidents) %>%
mutate(Date = as.Date(Date)) %>%
mutate(y = year(Date)) %>%
group_by(y) %>%
arrange(Date) %>%
mutate(Date = as.Date(cut(Date, '7 d'))) %>%
arrange(Date) %>%
group_by(Date) %>%
summarise_all(sum) %>%
select(-y) -> accidentsDF.weekly
accidentsDF.weekly %>%
select(-Date, -NB_Accidents) %>%
as.matrix() -> predictors.weekly
accidentsDF.weekly %<>%
select(Date, NB_Accidents)
fit.w <- auto.arima(dts.w, stepwise = T,trace = F,xreg=regressors,
parallel = TRUE);fit.w;checkresiduals(fit.w)
fit.w <- auto.arima(dts.w, stepwise = T,trace = F,xreg=predictors.weekly,
parallel = TRUE);fit.w;checkresiduals(fit.w)
fit.w <- auto.arima(dts.w, stepwise = F,trace = F,
parallel = TRUE);fit.w;checkresiduals(fit.w)
